<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Projecting COVID-19 Cases Under No Intervention Measures</title>

<script src="site_libs/header-attrs-2.1/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Spatial Data Discovery</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Learning
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="learning/netcdf/index.html">NetCDF</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="resource_data.html">Data</a>
    </li>
    <li>
      <a href="resource_link.html">Links</a>
    </li>
    <li>
      <a href="resource_meth.html">Methods</a>
    </li>
    <li>
      <a href="resource_soft.html">Software</a>
    </li>
    <li>
      <a href="https://drdavis.space/teaching/ds/sdd/syllabus/2020/spring/">Syllabus</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Spatial Discovery
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Example</li>
    <li>
      <a href="project_dtwoods.html">Breathing of the Biosphere</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Spring 2020</li>
    <li>
      <a href="project_mkcusick.html">COVID-19 Spread Within The US</a>
    </li>
    <li>
      <a href="project_msuri.html">COVID-19 Strictness Policies</a>
    </li>
    <li>
      <a href="project_grluisi.html">Global Earthquake Frequency</a>
    </li>
    <li>
      <a href="project_irthompson01.html">Monitoring Ocean Climate Change</a>
    </li>
    <li>
      <a href="project_jlollen.html">Opioid Epidemic</a>
    </li>
    <li>
      <a href="project_intj1.html">Projecting COVID-19 Cases</a>
    </li>
    <li>
      <a href="project_rhan9.html">Rise of a Superstar</a>
    </li>
    <li>
      <a href="project_emmgillstrick.html">Spread of Urbanization</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="projects.html">Previous Projects</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    About
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="about.html">The Coder Pages</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Spring 2020 Team</li>
    <li>
      <a href="about_abgaddi.html">abgaddi</a>
    </li>
    <li>
      <a href="about_aburke01.html">aburke01</a>
    </li>
    <li>
      <a href="about_dtwoods.html">dt-woods</a>
    </li>
    <li>
      <a href="about_elkelthen.html">elkelthen</a>
    </li>
    <li>
      <a href="about_emmgillstrick.html">emmgillstrick</a>
    </li>
    <li>
      <a href="about_gnmaniaci.html">gnmaniaci</a>
    </li>
    <li>
      <a href="about_grluisi.html">grluisi</a>
    </li>
    <li>
      <a href="about_hmbaier.html">hmbaier</a>
    </li>
    <li>
      <a href="about_intj1.html">intj1</a>
    </li>
    <li>
      <a href="about_irthompson01.html">irthompson01</a>
    </li>
    <li>
      <a href="about_jlollen.html">jlollen</a>
    </li>
    <li>
      <a href="about_jpcasale.html">jpcasale</a>
    </li>
    <li>
      <a href="about_leanlow.html">leanlow</a>
    </li>
    <li>
      <a href="about_luhuynh.html">luhuynh</a>
    </li>
    <li>
      <a href="about_mallikasuri.html">mallikasuri</a>
    </li>
    <li>
      <a href="about_matt-kc.html">matt-kc</a>
    </li>
    <li>
      <a href="about_nd3600.html">nd3600</a>
    </li>
    <li>
      <a href="about_pulakraj.html">pulakraj</a>
    </li>
    <li>
      <a href="about_rhan9.html">rhan9</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/spatial-data-discovery/spatial-data-discovery.github.io">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Projecting COVID-19 Cases Under No Intervention Measures</h1>

</div>


<!----Map------>
<div class="video-wrapper">
<p><video id = "scaledvideo" controls preload = "true" autoplay loop muted> <source src= '' type = "video/avi" > </video></p>
</div>
<!----Overview--->
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>As of April 28th, the number of confirmed COVID-19 cases world-wide rises to about 3.08 million, with aobut one third of those cases (1.03 million) is reported within the United States <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. With the number of deaths exceeding that of the common flu <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> within just a short period of time, and as some states are beginning to reopen <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>, It is important look back at how effective social distancing and lockdown could be by comparing the projection of infectives under no intervention measures.</p>
<p>While there are many epidemiological models available, the bread and butter of modeling any infectious diseases will have to be SIR (Susceptible, Infectives, Removed). For this project, the simpler SIR model is modified to include a delay factor <a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>:</p>
<p><img src="link1" alt="SIR model" /> <img src="link2" alt="SIR model with delay" /> <img src="link3" alt="tau description" /></p>
<p><span class="math display">\[
\frac{dS}{dt} = -\frac{\beta S_\tau I_\tau}{N}
\]</span></p>
<p>From this model, the parameters, beta and gamma, are estimated by MCMC<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> and current reported COVID-19 cases. Adaptive Metroplis Hastings and Delayed Rejection <a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> is used for 10000 simulations the likelihood function is assumed to be normal, with cost function being the sum of squared errors. All of these will not be possible without pymcmcstat<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>. Here are assumptions and initial conditions for projection:</p>
<ul>
<li><p>Basic state projection has an average population of about 6 millions (US pop / 50 states).</p></li>
<li><p>Susceptible population is the average population - (latest confirmed number / 50 states) - latest removed.</p></li>
<li><p>Removed is sum of (current recovered + current deaths) / 50 states.</p></li>
<li><p>The parameters from MCMC are used to project the number of infected cases 365 days into the future, starting from the latest available date.</p></li>
<li><p>Parameters beta and gamma are tuned within the MCMC so that the reproduction rate cannot</p></li>
<li><p>This projection assumes that <strong>absolutely no intervention measures were enforced</strong>.</p></li>
</ul>
<p><strong>Both MCMC simulations and projection assume a 14 days incubation period</strong>. Model is integrated using <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.odeint.html">scipy’s odeint</a>. The result projection:</p>
<div class="figure">
<img src="FinalProjection" alt="" />
<p class="caption">Projection</p>
</div>
<p>Based on the projection, for an “average state” of 6 million people, the number of infectives will peak at 200000 about 150 days from March 1st. Due to the simple nature of the model, many factors are not considered thus should only be is a representation of the worst case scenario. However, interesting information can still be extracted from this curve, such as the possible inflection point of around 110 days from March 1st, where the rates of infectives are slowing down.</p>
<!-----Data Description---->
</div>
<div id="data-description-and-data-processing" class="section level2">
<h2>Data Description and Data Processing</h2>
<p>The entire data aquisition and processing can be found <a href="https://github.com/spatial-data-discovery/ay1920-2/blob/master/project/intj1/process.ipynb">here</a>, with automated script [here](<a href="https://github.com/spatial-data-discovery/ay1920-2/blob/master/project/intj1/Map_generation_projection_script.py" class="uri">https://github.com/spatial-data-discovery/ay1920-2/blob/master/project/intj1/Map_generation_projection_script.py</a>.</p>
<p>The video above showed the number of COVID-19 cases with respect to location and deaths over the past two months. Notice the shift in scatter plot location from March 9th to March 10th, where cases recorded are grouped from local-wise to state wise. This state-wide report is once again reverted back to be more granular from March 21st to 22nd. Obvious hotspots of COVID-19 cases include NewYork, California, Wisconsin, and almost anywhere with highly dense population.</p>
<p>Johns Hopkins CSSEGIS offers detail information about COVID-19 cases all over the world. The primary data source is <a href="https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_daily_reports">here</a>. One major flaw of this database is its inconsistent formatting, especially in the “Recovered” column being all zeroes for regions within the US. This is a problem that the data collection team has to fix. Fortunately, MCMC simulations only relied on the number of confirmed cases.</p>
<p>A class was created to extract and reorganize relevant information for mappings: dates, column filters, etc.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">class</span> preProcess():</span>
<span id="cb1-2"><a href="#cb1-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, path, country):</span>
<span id="cb1-3"><a href="#cb1-3"></a>        <span class="va">self</span>.__dates <span class="op">=</span> <span class="bu">sorted</span>([re.search(<span class="vs">r&#39;(\d+-\d+-\d+)&#39;</span>, d).group() <span class="cf">for</span> d <span class="kw">in</span> glob.glob(os.path.join(path, <span class="st">&quot;*.csv&quot;</span>))])</span>
<span id="cb1-4"><a href="#cb1-4"></a>        <span class="va">self</span>.__df <span class="op">=</span> {re.search(<span class="vs">r&#39;(\d+-\d+-\d+)&#39;</span>,i).group(): pd.read_csv(i) <span class="cf">for</span> i <span class="kw">in</span> glob.glob(os.path.join(path, <span class="st">&quot;*.csv&quot;</span>))}</span>
<span id="cb1-5"><a href="#cb1-5"></a>        <span class="va">self</span>.c_format <span class="op">=</span> {<span class="st">&#39;Country/Region&#39;</span>, <span class="st">&#39;Country_Region&#39;</span>} <span class="co">#Upon looking at csv formats, I realized there are inconsistencies in keys. This should fix it.</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>        <span class="va">self</span>.coords_format <span class="op">=</span> {<span class="st">&#39;Latitude&#39;</span>, <span class="st">&#39;Longitude&#39;</span>, <span class="st">&#39;Lat&#39;</span>, <span class="st">&#39;Long_&#39;</span>}</span>
<span id="cb1-7"><a href="#cb1-7"></a>        <span class="va">self</span>.s_format <span class="op">=</span> {<span class="st">&#39;Province/State&#39;</span>, <span class="st">&#39;Province_State&#39;</span>}</span>
<span id="cb1-8"><a href="#cb1-8"></a>        <span class="va">self</span>.__countries <span class="op">=</span> <span class="bu">sorted</span>({country <span class="cf">for</span> d <span class="kw">in</span> <span class="va">self</span>.__dates <span class="cf">for</span> country <span class="kw">in</span> <span class="va">self</span>.__df[d][(<span class="va">self</span>.c_format <span class="op">&amp;</span> <span class="bu">set</span>(<span class="va">self</span>.__df[d].columns)).pop()]})</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a>        <span class="co">#1</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>        <span class="va">self</span>.__cDates <span class="op">=</span> <span class="bu">sorted</span>({i <span class="cf">for</span> i <span class="kw">in</span> <span class="va">self</span>.dates <span class="cf">if</span> country <span class="kw">in</span> <span class="bu">set</span>(<span class="va">self</span>.df[i][(<span class="va">self</span>.c_format <span class="op">&amp;</span> <span class="bu">set</span>(<span class="va">self</span>.df[i].columns)).pop()])} <span class="op">&amp;</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>                               {j <span class="cf">for</span> j <span class="kw">in</span> <span class="va">self</span>.dates <span class="cf">if</span> <span class="bu">len</span>(<span class="bu">set</span>(<span class="va">self</span>.df[j][(<span class="va">self</span>.coords_format <span class="op">&amp;</span> <span class="bu">set</span>(<span class="va">self</span>.df[j].columns))]))})</span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a>        <span class="co">#2</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>        <span class="va">self</span>.__country <span class="op">=</span> <span class="va">self</span>.countryBreakDown(country)</span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a>        <span class="co">#3</span></span>
<span id="cb1-18"><a href="#cb1-18"></a>        <span class="va">self</span>.__states <span class="op">=</span> <span class="va">self</span>.statesBreakDown()...        </span></code></pre></div>
<p>Where reusable variables are important in making the structure easier to identify for the users:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">#Break down stats by State/Province</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">def</span> countryBreakDown(<span class="va">self</span>, country):</span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="co">#Data processing is getting more difficult than I though. Let&#39;s hope that they stop changing the data format as the day goes on.</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>    pre_df <span class="op">=</span> {d: <span class="va">self</span>.df[d][<span class="va">self</span>.df[d][(<span class="va">self</span>.c_format <span class="op">&amp;</span> <span class="bu">set</span>(<span class="va">self</span>.df[d].columns)).pop()] <span class="op">==</span> country][[(<span class="va">self</span>.s_format <span class="op">&amp;</span> <span class="bu">set</span>(<span class="va">self</span>.df[d].columns)).pop(),</span>
<span id="cb2-5"><a href="#cb2-5"></a>                                       <span class="bu">sorted</span>(<span class="va">self</span>.coords_format <span class="op">&amp;</span> <span class="bu">set</span>(<span class="va">self</span>.df[d].columns))[<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb2-6"><a href="#cb2-6"></a>                                       <span class="bu">sorted</span>(<span class="va">self</span>.coords_format <span class="op">&amp;</span> <span class="bu">set</span>(<span class="va">self</span>.df[d].columns))[<span class="dv">0</span>],</span>
<span id="cb2-7"><a href="#cb2-7"></a>                                       <span class="st">&#39;Confirmed&#39;</span>, <span class="st">&#39;Recovered&#39;</span>, <span class="st">&#39;Deaths&#39;</span>]].set_index((<span class="va">self</span>.s_format <span class="op">&amp;</span> <span class="bu">set</span>(<span class="va">self</span>.df[d].columns)).pop()) <span class="cf">for</span> d <span class="kw">in</span> <span class="va">self</span>.cDates}</span>
<span id="cb2-8"><a href="#cb2-8"></a>    <span class="co">#Add multi-Index</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>    <span class="cf">for</span> k, v <span class="kw">in</span> pre_df.items():</span>
<span id="cb2-10"><a href="#cb2-10"></a>        coords <span class="op">=</span> <span class="bu">list</span>(prod([<span class="st">&#39;Coordinates&#39;</span>], v.columns[:<span class="dv">2</span>]))</span>
<span id="cb2-11"><a href="#cb2-11"></a>        coords.extend(<span class="bu">list</span>(prod([k], v.columns[<span class="dv">2</span>:])))</span>
<span id="cb2-12"><a href="#cb2-12"></a>        v.columns <span class="op">=</span> pd.MultiIndex.from_tuples(coords)</span>
<span id="cb2-13"><a href="#cb2-13"></a>        v.index.names <span class="op">=</span> [<span class="st">&#39;State/Province&#39;</span>] <span class="co">#Rename index level for consistency</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>    <span class="cf">return</span> pre_df</span>
<span id="cb2-15"><a href="#cb2-15"></a></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">#Statesbreak down. PASS IN self.country</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="kw">def</span> statesBreakDown(<span class="va">self</span>):</span>
<span id="cb2-18"><a href="#cb2-18"></a>        statesdict <span class="op">=</span> {<span class="st">&quot;D.C&quot;</span>:<span class="st">&quot;District of Columbia&quot;</span>,<span class="st">&quot;AL&quot;</span>:<span class="st">&quot;Alabama&quot;</span>,<span class="st">&quot;AK&quot;</span>:<span class="st">&quot;Alaska&quot;</span>,<span class="st">&quot;AZ&quot;</span>:<span class="st">&quot;Arizona&quot;</span>,<span class="st">&quot;AR&quot;</span>:<span class="st">&quot;Arkansas&quot;</span>,<span class="st">&quot;CA&quot;</span>:<span class="st">&quot;California&quot;</span>,<span class="st">&quot;CO&quot;</span>:<span class="st">&quot;Colorado&quot;</span>,<span class="st">&quot;CT&quot;</span>:<span class="st">&quot;Connecticut&quot;</span>,<span class="st">&quot;DE&quot;</span>:<span class="st">&quot;Delaware&quot;</span>,<span class="st">&quot;FL&quot;</span>:<span class="st">&quot;Florida&quot;</span>,<span class="st">&quot;GA&quot;</span>:<span class="st">&quot;Georgia&quot;</span>,<span class="st">&quot;HI&quot;</span>:<span class="st">&quot;Hawaii&quot;</span>,<span class="st">&quot;ID&quot;</span>:<span class="st">&quot;Idaho&quot;</span>,<span class="st">&quot;IL&quot;</span>:<span class="st">&quot;Illinois&quot;</span>,<span class="st">&quot;IN&quot;</span>:<span class="st">&quot;Indiana&quot;</span>,<span class="st">&quot;IA&quot;</span>:<span class="st">&quot;Iowa&quot;</span>,<span class="st">&quot;KS&quot;</span>:<span class="st">&quot;Kansas&quot;</span>,<span class="st">&quot;KY&quot;</span>:<span class="st">&quot;Kentucky&quot;</span>,<span class="st">&quot;LA&quot;</span>:<span class="st">&quot;Louisiana&quot;</span>,<span class="st">&quot;ME&quot;</span>:<span class="st">&quot;Maine&quot;</span>,<span class="st">&quot;MD&quot;</span>:<span class="st">&quot;Maryland&quot;</span>,<span class="st">&quot;MA&quot;</span>:<span class="st">&quot;Massachusetts&quot;</span>,<span class="st">&quot;MI&quot;</span>:<span class="st">&quot;Michigan&quot;</span>,<span class="st">&quot;MN&quot;</span>:<span class="st">&quot;Minnesota&quot;</span>,<span class="st">&quot;MS&quot;</span>:<span class="st">&quot;Mississippi&quot;</span>,<span class="st">&quot;MO&quot;</span>:<span class="st">&quot;Missouri&quot;</span>,<span class="st">&quot;MT&quot;</span>:<span class="st">&quot;Montana&quot;</span>,<span class="st">&quot;NE&quot;</span>:<span class="st">&quot;Nebraska&quot;</span>,<span class="st">&quot;NV&quot;</span>:<span class="st">&quot;Nevada&quot;</span>,<span class="st">&quot;NH&quot;</span>:<span class="st">&quot;New Hampshire&quot;</span>,<span class="st">&quot;NJ&quot;</span>:<span class="st">&quot;New Jersey&quot;</span>,<span class="st">&quot;NM&quot;</span>:<span class="st">&quot;New Mexico&quot;</span>,<span class="st">&quot;NY&quot;</span>:<span class="st">&quot;New York&quot;</span>,<span class="st">&quot;NC&quot;</span>:<span class="st">&quot;North Carolina&quot;</span>,<span class="st">&quot;ND&quot;</span>:<span class="st">&quot;North Dakota&quot;</span>,<span class="st">&quot;OH&quot;</span>:<span class="st">&quot;Ohio&quot;</span>,<span class="st">&quot;OK&quot;</span>:<span class="st">&quot;Oklahoma&quot;</span>,<span class="st">&quot;OR&quot;</span>:<span class="st">&quot;Oregon&quot;</span>,<span class="st">&quot;PA&quot;</span>:<span class="st">&quot;Pennsylvania&quot;</span>,<span class="st">&quot;RI&quot;</span>:<span class="st">&quot;Rhode Island&quot;</span>,<span class="st">&quot;SC&quot;</span>:<span class="st">&quot;South Carolina&quot;</span>,<span class="st">&quot;SD&quot;</span>:<span class="st">&quot;South Dakota&quot;</span>,<span class="st">&quot;TN&quot;</span>:<span class="st">&quot;Tennessee&quot;</span>,<span class="st">&quot;TX&quot;</span>:<span class="st">&quot;Texas&quot;</span>,<span class="st">&quot;UT&quot;</span>:<span class="st">&quot;Utah&quot;</span>,<span class="st">&quot;VT&quot;</span>:<span class="st">&quot;Vermont&quot;</span>,<span class="st">&quot;VA&quot;</span>:<span class="st">&quot;Virginia&quot;</span>,<span class="st">&quot;WA&quot;</span>:<span class="st">&quot;Washington&quot;</span>,<span class="st">&quot;WV&quot;</span>:<span class="st">&quot;West Virginia&quot;</span>,<span class="st">&quot;WI&quot;</span>:<span class="st">&quot;Wisconsin&quot;</span>,<span class="st">&quot;WY&quot;</span>:<span class="st">&quot;Wyoming&quot;</span>}</span>
<span id="cb2-19"><a href="#cb2-19"></a>        DPfilter <span class="op">=</span> {<span class="st">&#39;Unassigned Location (From Diamond Princess)&#39;</span>,<span class="st">&#39;Grand Princess Cruise Ship&#39;</span>}</span>
<span id="cb2-20"><a href="#cb2-20"></a>        <span class="co">#Use latest date as scheme for merge. This relies heavily on the latest date contains coords</span></span>
<span id="cb2-21"><a href="#cb2-21"></a>        latest <span class="op">=</span> <span class="va">self</span>.cDates[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb2-22"><a href="#cb2-22"></a>        dff <span class="op">=</span> <span class="va">self</span>.country[latest].groupby(<span class="va">self</span>.country[latest].index).<span class="bu">sum</span>()</span>
<span id="cb2-23"><a href="#cb2-23"></a>        dff.drop(columns <span class="op">=</span> dff.columns.levels[<span class="dv">0</span>][<span class="dv">0</span>], level <span class="op">=</span> <span class="dv">0</span>, inplace <span class="op">=</span> <span class="va">True</span>) <span class="co">#Drop the date columns, so all we have now are the states</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>        <span class="cf">if</span> <span class="bu">len</span>(dff.columns.levels) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb2-25"><a href="#cb2-25"></a>            dff.drop(columns <span class="op">=</span> dff.columns.levels[<span class="dv">0</span>][<span class="dv">1</span>], level <span class="op">=</span> <span class="dv">0</span>, inplace <span class="op">=</span> <span class="va">True</span>) <span class="co">#DROPPING COORDINATES TOO. COMMENT IF NEEDED</span></span>
<span id="cb2-26"><a href="#cb2-26"></a>        <span class="co">#####################################################################</span></span>
<span id="cb2-27"><a href="#cb2-27"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="va">self</span>.cDates:</span>
<span id="cb2-28"><a href="#cb2-28"></a>            df <span class="op">=</span> <span class="va">self</span>.country[i].groupby(<span class="va">self</span>.country[i].index).<span class="bu">sum</span>()</span>
<span id="cb2-29"><a href="#cb2-29"></a>            <span class="co">#Some dates do not have the coordinates column, Need to check length of level 0 multiIndex</span></span>
<span id="cb2-30"><a href="#cb2-30"></a>            <span class="cf">if</span> <span class="bu">len</span>(df.columns.levels) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb2-31"><a href="#cb2-31"></a>                df.drop(columns <span class="op">=</span> df.columns.levels[<span class="dv">0</span>][<span class="dv">1</span>], level <span class="op">=</span> <span class="dv">0</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb2-32"><a href="#cb2-32"></a>            <span class="co">#before merging, filter state/province columns from previous dates</span></span>
<span id="cb2-33"><a href="#cb2-33"></a>            <span class="cf">if</span> <span class="bu">len</span>(<span class="bu">set</span>(df.index) <span class="op">&amp;</span> DPfilter):</span>
<span id="cb2-34"><a href="#cb2-34"></a>                df.drop(index <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(df.index) <span class="op">&amp;</span> DPfilter), inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb2-35"><a href="#cb2-35"></a>            filtered <span class="op">=</span> [re.findall(<span class="vs">r&#39;([A-Z]</span><span class="sc">{2}</span><span class="vs">|[A\.-Z]</span><span class="sc">{3}</span><span class="vs">)&#39;</span>, x)[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> df.index <span class="cf">if</span> <span class="bu">len</span>(re.findall(<span class="vs">r&#39;([A-Z]</span><span class="sc">{2}</span><span class="vs">|[A\.-Z]</span><span class="sc">{3}</span><span class="vs">)&#39;</span>, x)) <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb2-36"><a href="#cb2-36"></a>            <span class="cf">if</span> <span class="bu">len</span>(<span class="bu">set</span>(statesdict) <span class="op">&amp;</span> <span class="bu">set</span>(filtered)):</span>
<span id="cb2-37"><a href="#cb2-37"></a>                df.index <span class="op">=</span> [statesdict[s] <span class="cf">for</span> s <span class="kw">in</span> filtered]</span>
<span id="cb2-38"><a href="#cb2-38"></a>                df <span class="op">=</span> df.groupby(df.index).<span class="bu">sum</span>()</span>
<span id="cb2-39"><a href="#cb2-39"></a>                df.index.names <span class="op">=</span> [<span class="st">&#39;State/Province&#39;</span>]</span>
<span id="cb2-40"><a href="#cb2-40"></a>            dff <span class="op">=</span> pd.merge(dff, df, how <span class="op">=</span> <span class="st">&#39;left&#39;</span>, on <span class="op">=</span> <span class="st">&#39;State/Province&#39;</span>)</span>
<span id="cb2-41"><a href="#cb2-41"></a>        <span class="co">#Depending on new locations, might need to add or remove from below</span></span>
<span id="cb2-42"><a href="#cb2-42"></a>        dff.drop(index <span class="op">=</span> [<span class="st">&#39;Recovered&#39;</span>,<span class="st">&#39;Virgin Islands&#39;</span>, <span class="st">&#39;Northern Mariana Islands&#39;</span>, <span class="st">&#39;Grand Princess&#39;</span>, <span class="st">&#39;Diamond Princess&#39;</span>, <span class="st">&#39;Puerto Rico&#39;</span>], inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb2-43"><a href="#cb2-43"></a>        dff.fillna(<span class="dv">0</span>, inplace <span class="op">=</span> <span class="va">True</span>) <span class="co">#Fill na for states whose values don&#39;t exist from previous dates</span></span>
<span id="cb2-44"><a href="#cb2-44"></a>        <span class="cf">return</span> dff</span></code></pre></div>
<p>Overall, what determines whether or not the script will work in the future is contingent on the data collection teams and their willingness to be consistent.</p>
<p>During this process, high performance processing modules like pandas<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>, numpy<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>, re<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>, and itertools<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a> are helpful in data manipulation and multiIndexing during reformat. Map creation was made easy with basemap<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>, where pyplot<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a> as then used to project COVID-19 statistic upon. After the data is processed and mapped, cv2<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a> was used to stitch these maps together.</p>
<div class="credit-line">
<p>Author: Tinh Son Last edited: 2020-04-28</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://news.google.com/covid19/map?hl=en-US&amp;gl=US&amp;ceid=US:en" class="uri">https://news.google.com/covid19/map?hl=en-US&amp;gl=US&amp;ceid=US:en</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p><a href="https://www.cdc.gov/flu/about/burden/index.html" class="uri">https://www.cdc.gov/flu/about/burden/index.html</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p><a href="https://www.cdc.gov/flu/about/burden/preliminary-in-season-estimates.htm" class="uri">https://www.cdc.gov/flu/about/burden/preliminary-in-season-estimates.htm</a><a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p><a href="https://www.hindawi.com/journals/ddns/2008/636153/" class="uri">https://www.hindawi.com/journals/ddns/2008/636153/</a><a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p><a href="https://towardsdatascience.com/a-zero-math-introduction-to-markov-chain-monte-carlo-methods-dcba889e0c50" class="uri">https://towardsdatascience.com/a-zero-math-introduction-to-markov-chain-monte-carlo-methods-dcba889e0c50</a><a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p><a href="http://helios.fmi.fi/~lainema/dram/" class="uri">http://helios.fmi.fi/~lainema/dram/</a><a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p><a href="https://pypi.org/project/pymcmcstat/" class="uri">https://pypi.org/project/pymcmcstat/</a><a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p><a href="https://pandas.pydata.org/" class="uri">https://pandas.pydata.org/</a><a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p><a href="https://numpy.org/" class="uri">https://numpy.org/</a><a href="#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p><a href="https://docs.python.org/3/library/re.html" class="uri">https://docs.python.org/3/library/re.html</a><a href="#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p><a href="https://docs.python.org/3/library/itertools.html" class="uri">https://docs.python.org/3/library/itertools.html</a><a href="#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p><a href="https://matplotlib.org/basemap/" class="uri">https://matplotlib.org/basemap/</a><a href="#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p><a href="https://matplotlib.org/3.2.1/api/_as_gen/matplotlib.pyplot.html" class="uri">https://matplotlib.org/3.2.1/api/_as_gen/matplotlib.pyplot.html</a><a href="#fnref13" class="footnote-back">↩︎</a></p></li>
<li id="fn14"><p><a href="https://pypi.org/project/opencv-python/" class="uri">https://pypi.org/project/opencv-python/</a><a href="#fnref14" class="footnote-back">↩︎</a></p></li>
</ol>
</div>

<footer class="myfoot">
    <div class="foot-text">
        <p>Data Science at William &amp; Mary (2020)</p>
    </div>
</footer>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
